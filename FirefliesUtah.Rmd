---
title: "Utah Firefly Populatons 2014-2024"
author: "Grant Patterson"
date: "2025-11-13"
output: 
  github_document:
    toc: true
---

# Abstract

# Background

Fireflies are found throughout North America, being the most prevalent in the Eastern United States. There are populations throughout the Western states as well, though their population distribution is not well documented. To amend this, a citizen science program was started to report sightings of fireflies throughout Utah. These sightings were recorded between 2014 and 2024, including the date, time, and county of the sightings. Not all of this data was properly reported though, with some dates ranging as far back as 1964 (likely an unintentional error on the part of the reporter or recorder). We took this data and parsed through it, clarifying or removing data that was not of proper use to us before we began our analysis.

# Study questions and Hypothesis

## Questions

How do geographic location and biome type impact Utah firefly population size? How does this change North to South?

## Hypothesis

While Southern Utah grows warmer sooner, the higher forestation and more marshlands in Northern Utah will lead to higher Firefly populations in Norther Utah than Southern Utah.

## Prediction

There will be higher firefly populations in Northern than Southern Utah

# Methods

This data on firefly populations was collected as a citizen science effort, wherein data submissions were open to the general public, as opposed to just those of a scientific background. This information was then cleaned up by the collection team and then our team did further cleaning up of the data (expanding abbreviations, clarifying negative values that aught to have been positive, and removing irrelevant information).

## First Analysis - Boxplot

```{r}
# Firefly Boxplot (Log-Transformed, No Blanks)

library(ggplot2)

# Read in the data
fireflies <- read.csv("Copy of firefliesUtah - Usable Data.csv", stringsAsFactors = FALSE)
colnames(fireflies) <- c("firefly_count", "region")

# Remove blank or missing region values
fireflies <- subset(fireflies, region != "" & !is.na(region))

# Box plot with log10 transformation (+1 to avoid log(0))
ggplot(fireflies, aes(x = region, y = log10(firefly_count + 1), fill = region)) +
geom_boxplot(width = 0.6, color = "black", alpha = 0.7) +
labs(
title = "Firefly Abundance by Region (Log Scale)",
x = "Region",
y = "Log-Transformed Firefly Count"
) +
scale_fill_manual(values = c("north" = "#8EC9E8", "south" = "#F4A261")) +
theme_minimal(base_size = 13) +
theme(
legend.position = "none",
plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
axis.text = element_text(size = 12),
axis.title = element_text(size = 13),
panel.grid.major.x = element_blank(),
panel.grid.minor = element_blank()
)
```

##second analysis

```{r}
# Split Violin Plot (y-axis limited to 50)r

library(ggplot2)
library(gghalves)
library(stringi)

# Read and clean your data
fireflies <- read.csv("Copy of firefliesUtah - Usable Data.csv", stringsAsFactors = FALSE)
colnames(fireflies) <- c("firefly_count", "region")

fireflies$region[fireflies$region == ""] <- NA
fireflies$region <- stri_trans_general(fireflies$region, "NFKC")
fireflies$region <- stri_replace_all_regex(fireflies$region, "\\p{C}", "")
fireflies$region <- gsub("\u00A0", " ", fireflies$region)
fireflies$region <- trimws(tolower(fireflies$region))
fireflies$region[fireflies$region %in% c("n", "nrth", "noth")] <- "north"
fireflies$region[fireflies$region %in% c("s", "sth", "soth")] <- "south"
fireflies$region <- factor(fireflies$region, levels = c("north", "south"))
fireflies_clean <- droplevels(subset(fireflies, !is.na(region)))

# Split violin plot
ggplot() +
geom_half_violin(
data = subset(fireflies_clean, region == "north"),
aes(x = factor(1), y = firefly_count, fill = region),
side = "l", trim = TRUE, color = "black", alpha = 0.7
) +
geom_half_violin(
data = subset(fireflies_clean, region == "south"),
aes(x = factor(1), y = firefly_count, fill = region),
side = "r", trim = TRUE, color = "black", alpha = 0.7
) +
scale_fill_manual(values = c("north" = "#8EC9E8", "south" = "#F4A261")) +
coord_cartesian(ylim = c(0, 50)) + # y-axis capped at 50
labs(
title = "Firefly Abundance: North vs South",
x = NULL,
y = "Firefly Count"
) +
theme_minimal(base_size = 13) +
theme(
legend.position = "bottom",
plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
axis.text.x = element_blank(),
axis.ticks.x = element_blank()
)
```

Code for Poisson Regression

```{r}
# Read in the data
fireflies <- read.csv("Copy of firefliesUtah - Usable Data.csv", stringsAsFactors = FALSE)
colnames(fireflies) <- c("firefly_count", "region")

# Remove blank or missing region values
fireflies <- subset(fireflies, region != "" & !is.na(region))

# Poisson regression
poisson_model <- glm(firefly_count ~ region, data = fireflies, family = "poisson")

# Summary of the model
summary(poisson_model)

# Exponentiated coefficients (rate ratios)
exp(coef(poisson_model))

# Check for overdispersion
dispersion <- sum(residuals(poisson_model, type = "pearson")^2) / poisson_model$df.residual
dispersion # If > 1.5, overdispersion may be present

# Quasi-Poisson if overdispersion
quasi_model <- glm(firefly_count ~ region, data = fireflies, family = "quasipoisson")
summary(quasi_model)

# Add predicted counts to the data
fireflies$predicted_count <- predict(poisson_model, newdata = fireflies, type = "response")
```

# Discussion


## Interpretation of Analysis 1

*Fill later after I get this code running properly and the box plot running*

# Conclusion

*Fill after all analyses are up*

# References

*For now, just the link, this will be updated later* <https://docs.google.com/spreadsheets/d/1p3Gv6F1u4GXp2thnB-FvD5aYHqHRUH9K-lViqrgiSzo/edit?gid=2103391198#gid=2103391198>
<https://www.sciencedirect.com/science/article/pii/S0304380007003511>